<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sharon Voon">
<meta name="dcterms.date" content="2024-02-11">
<meta name="description" content="Simulating the logs of user purchases, product views, cart history, and the user’s journey to build batch and real-time pipelines tto detect DDos and bot attacks">

<title>Sharon Voon - End-to-End Real-Time eCommerce Analytics Pipeline using AWS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../imgs/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../blogs/ecommerce_analytics/index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../imgs/favicon.png" alt="SV" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../blogs/ecommerce_analytics/index.html">
    <span class="navbar-title">Sharon Voon</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../#background" rel="" target="">
 <span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blogs.html" rel="" target="">
 <span class="menu-text">Blogs</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/s-voon" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="https://www.linkedin.com/in/sharonvoon/" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">End-to-End Real-Time eCommerce Analytics Pipeline using AWS</h1>
                  <div>
        <div class="description">
          Simulating the logs of user purchases, product views, cart history, and the user’s journey to build batch and real-time pipelines tto detect DDos and bot attacks
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">AWS</div>
                <div class="quarto-category">ETL</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://s-voon.github.io/">Sharon Voon</a> </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Master of Data Science Student, UBC, 2023
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 11, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#real-time-processing-defending-against-ddos-and-bot-attacks" id="toc-real-time-processing-defending-against-ddos-and-bot-attacks" class="nav-link" data-scroll-target="#real-time-processing-defending-against-ddos-and-bot-attacks">Real-Time Processing: Defending Against DDoS and Bot Attacks</a></li>
  <li><a href="#batch-time-processing-gaining-deep-insights-into-customer-behavior-product-trends-and-overall-business-performance." id="toc-batch-time-processing-gaining-deep-insights-into-customer-behavior-product-trends-and-overall-business-performance." class="nav-link" data-scroll-target="#batch-time-processing-gaining-deep-insights-into-customer-behavior-product-trends-and-overall-business-performance.">Batch-Time Processing: Gaining deep insights into customer behavior, product trends, and overall business performance.</a></li>
  </ul></li>
  <li><a href="#aws-services" id="toc-aws-services" class="nav-link" data-scroll-target="#aws-services">AWS Services</a></li>
  <li><a href="#aws-introduction" id="toc-aws-introduction" class="nav-link" data-scroll-target="#aws-introduction">AWS Introduction</a></li>
  <li><a href="#architecture" id="toc-architecture" class="nav-link" data-scroll-target="#architecture">Architecture</a></li>
  <li><a href="#data-stream-and-simulation-setup" id="toc-data-stream-and-simulation-setup" class="nav-link" data-scroll-target="#data-stream-and-simulation-setup">Data Stream and Simulation Setup</a>
  <ul class="collapse">
  <li><a href="#creating-a-data-stream" id="toc-creating-a-data-stream" class="nav-link" data-scroll-target="#creating-a-data-stream">Creating a Data Stream</a></li>
  <li><a href="#running-the-simulation-python-app-using-kinesis-stream" id="toc-running-the-simulation-python-app-using-kinesis-stream" class="nav-link" data-scroll-target="#running-the-simulation-python-app-using-kinesis-stream">Running the Simulation Python App Using Kinesis Stream</a></li>
  <li><a href="#using-aws-glue-and-athena-for-kinesis-partition-key" id="toc-using-aws-glue-and-athena-for-kinesis-partition-key" class="nav-link" data-scroll-target="#using-aws-glue-and-athena-for-kinesis-partition-key">Using AWS Glue and Athena for Kinesis Partition Key</a></li>
  <li><a href="#configuring-kinesis-data-analytics-with-apache-flink" id="toc-configuring-kinesis-data-analytics-with-apache-flink" class="nav-link" data-scroll-target="#configuring-kinesis-data-analytics-with-apache-flink">Configuring Kinesis Data Analytics with Apache Flink</a></li>
  <li><a href="#integrate-lambda-and-kinesis" id="toc-integrate-lambda-and-kinesis" class="nav-link" data-scroll-target="#integrate-lambda-and-kinesis">Integrate Lambda and Kinesis</a></li>
  <li><a href="#etl-with-aws-glue-studio-databrew-and-apache-spark" id="toc-etl-with-aws-glue-studio-databrew-and-apache-spark" class="nav-link" data-scroll-target="#etl-with-aws-glue-studio-databrew-and-apache-spark">ETL with AWS Glue Studio, DataBrew, and Apache Spark</a></li>
  <li><a href="#persist-raw-stream-data-with-amazon-kinesis-firehose" id="toc-persist-raw-stream-data-with-amazon-kinesis-firehose" class="nav-link" data-scroll-target="#persist-raw-stream-data-with-amazon-kinesis-firehose">Persist Raw Stream Data with Amazon Kinesis Firehose</a></li>
  <li><a href="#quicksight-configuration" id="toc-quicksight-configuration" class="nav-link" data-scroll-target="#quicksight-configuration">QuickSight Configuration</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">




<style>
h1.title {
    color: white;
}
</style>
<p>An e-commerce analytics platform serves as the backbone of the data-driven decision-making in online retail. By harnessing data from various souces, such as transaction logs, customer interactions, and website traffic, business can:</p>
<ul>
<li>identify trends and patterns in customer purchasing behaviour</li>
<li>Optimize pricing strategies to maximize revenue</li>
<li>Improve customer retention through personalized recommendations</li>
<li>Detect anomalies that may signal fraudalent activities or distributed denial of service (DDoS) and bott attacks</li>
</ul>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In this blog, I will walk you through how I built an ETL pipeline for eCommerce analytics using AWS services. This project mimics real-life scenarios by leveraging Amazon Kinesis for real-time data streaming and processing. We will build a pipeline that ingests data in real-time from simulated user clickstreams and processes it using various AWS services to generate insights on user behavior, product trends, and more.</p>
<section id="real-time-processing-defending-against-ddos-and-bot-attacks" class="level3">
<h3 class="anchored" data-anchor-id="real-time-processing-defending-against-ddos-and-bot-attacks">Real-Time Processing: Defending Against DDoS and Bot Attacks</h3>
<p>Real-time processing is essential for safeguarding your e-commerce platform, especially in the face of increasing threats like DDoS attacks and bot-driven traffic spikes. These attacks can harm your business by disrupting services, slowing down the platform, or inflating costs.</p>
<p>To address these challenges, we will leverage AWS services such as AWS Lambda, Amazon DynamoDB, Amazon CloudWatch, and AWS SNS to build an automated pipeline that detects and mitigates these attacks in real-time.</p>
<p>Key Components of the Real-Time Processing Pipeline:</p>
<ol type="1">
<li><p>AWS Lambda: Handles the real-time execution of code to process incoming traffic data, detect anomalies, and trigger alerts.</p></li>
<li><p>Amazon DynamoDB: Stores real-time traffic data, allowing rapid lookups and comparisons to identify suspicious patterns.</p></li>
<li><p>Amazon CloudWatch: Monitors traffic and application performance, enabling detection of unusual activity, such as traffic spikes indicative of bot or DDoS attacks.</p></li>
<li><p>AWS SNS (Simple Notification Service): Sends instant notifications to administrators or security teams when abnormal traffic patterns are detected, allowing immediate action.</p></li>
</ol>
<p>This real-time processing pipeline ensures your e-commerce platform remains secure, stable, and ready to scale while mitigating potential threats in real time.</p>
</section>
<section id="batch-time-processing-gaining-deep-insights-into-customer-behavior-product-trends-and-overall-business-performance." class="level3">
<h3 class="anchored" data-anchor-id="batch-time-processing-gaining-deep-insights-into-customer-behavior-product-trends-and-overall-business-performance.">Batch-Time Processing: Gaining deep insights into customer behavior, product trends, and overall business performance.</h3>
<p>Batch processing is ideal for analyzing large volumes of historical data, enabling businesses to extract valuable insights that drive strategic decisions. In this blog, we’ll design a batch processing pipeline using Amazon Kinesis, AWS Glue, Amazon S3, and Amazon QuickSight. This architecture will provide insights into key metrics such as unique daily visitors, product engagement trends, and category performance.</p>
<p>Key Components of the Batch Processing Pipeline:</p>
<ol type="1">
<li><p>Amazon Kinesis: Ingests real-time streaming data from various e-commerce sources, such as user activity logs, transaction records, and website events. This data is then batched and stored for further processing.</p></li>
<li><p>AWS Glue: Extracts, transforms, and loads (ETL) data from the ingested raw data, ensuring it is properly formatted and cleaned. AWS Glue automates the schema discovery process and builds data catalog tables, making it easy to transform data into an analytics-ready state.</p></li>
<li><p>Amazon S3: Acts as the data lake, where the processed and cleaned data is stored. Amazon S3 provides scalable and cost-effective storage for large datasets, making it ideal for handling the volume of data generated by an e-commerce platform.</p></li>
<li><p>Amazon QuickSight: A powerful visualization tool that connects to the data in Amazon S3 and creates dashboards and reports. QuickSight enables you to visualize key metrics, such as traffic trends, top categories, and brand performance, in an easy-to-digest format. Decision-makers can use these reports to track KPIs, identify patterns, and make data-driven decisions.</p></li>
</ol>
</section>
</section>
<section id="aws-services" class="level2">
<h2 class="anchored" data-anchor-id="aws-services">AWS Services</h2>
<p>Before we dive into the service, I would like to credit the data source we used in this project which can be found <a href="https://www.kaggle.com/datasets/mkechinov/ecommerce-behavior-data-from-multi-category-store">here</a>.</p>
</section>
<section id="aws-introduction" class="level2">
<h2 class="anchored" data-anchor-id="aws-introduction">AWS Introduction</h2>
<ol type="1">
<li><p>Amazon S3: A scalable, secure object storage service for saving and retrieving unlimited data from anywhere, at any time.</p></li>
<li><p>AWS Glue: A serverless data integration service for ETL tasks, enabling data discovery, preparation, and merging for analytics and machine learning. It runs Spark/Python code without infrastructure management, charging based on job runtime and data catalog storage. Users often leverage Crawlers to automatically update tables in the AWS Glue Data Catalog.</p></li>
<li><p>AWS Athena: A serverless, interactive query service for querying data stored in S3, supporting multiple formats like CSV, JSON, ORC, Parquet, and AVRO.</p></li>
<li><p>Apache Flink: A scalable platform for real-time data analytics and distributed processing, handling both unbounded (continuous) and bounded (batch) data streams, with built-in fault tolerance and in-memory computation.</p></li>
<li><p>Amazon Kinesis Data Streams: A real-time data collection and processing service that supports building custom data-processing applications. Kinesis Data Firehose simplifies data delivery to destinations and can also transform data before sending.</p></li>
<li><p>Amazon QuickSight: A scalable, serverless business intelligence service powered by machine learning. It supports pay-per-session pricing, connects to diverse data sources, and delivers interactive dashboards and reports.</p></li>
<li><p>AWS Glue DataBrew: A visual data preparation tool that simplifies cleaning and transforming data without code, offering pre-built transformations for faster data prep.</p></li>
<li><p>Amazon DynamoDB: A fully managed NoSQL database providing fast, predictable performance with seamless scaling, designed to handle any volume of data and traffic without downtime.</p></li>
</ol>
</section>
<section id="architecture" class="level2">
<h2 class="anchored" data-anchor-id="architecture">Architecture</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="architecture.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">The overview of data pipeline for both the real-time processing and batch-time processing</figcaption>
</figure>
</div>
<p>The raw data stream will first be ingested into Amazon Kinesis Data Stream (stream1), which will then stream the data to Amazon Kinesis Data Analytics for processing. Here, an Apache Flink application will be utilized to analyze the data and detect any potential DDoS attacks. The clean, filtered data will then be sent to another Amazon Kinesis Data Stream (stream2).</p>
<p>The Flink application will be built using SQL on Amazon Kinesis Data Analytics, and to manage metadata, we will use the AWS Glue Data Catalog.</p>
<p>Next, stream2 will trigger an AWS Lambda function that will send Amazon SNS notifications to stakeholders, and fraudulent transaction details will be logged in a DynamoDB table for further analysis.</p>
<p>However, as seen in the architecture diagram, the raw data entering Kinesis Data Stream (stream1) is not stored anywhere. This presents a challenge: if a bug is later found and fixed in the Apache Flink application, the previously processed data cannot be re-processed, as we have no backup of the raw data. To mitigate this, it’s essential to store a copy of the raw data for future reprocessing or batch processing.</p>
<p>To address this, we will also route the incoming stream from Kinesis Data Stream (stream1) to Kinesis Firehose, which will store the raw data in Amazon S3. Using AWS Glue, we will catalog this data and run Glue ETL jobs to clean and process it. This enables us to further analyze the data through Amazon Athena and leverage QuickSight to build insightful dashboards for visualization.</p>
</section>
<section id="data-stream-and-simulation-setup" class="level2">
<h2 class="anchored" data-anchor-id="data-stream-and-simulation-setup">Data Stream and Simulation Setup</h2>
<section id="creating-a-data-stream" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-data-stream">Creating a Data Stream</h3>
<ul>
<li>Navigate to AWS Kinesis and select “Create Data Stream.”</li>
<li>Name the data stream: ecommerce-raw-user-activity-stream-1.</li>
<li>Set the capacity mode to “On-Demand” for variable throughput requirements.</li>
</ul>
</section>
<section id="running-the-simulation-python-app-using-kinesis-stream" class="level3">
<h3 class="anchored" data-anchor-id="running-the-simulation-python-app-using-kinesis-stream">Running the Simulation Python App Using Kinesis Stream</h3>
<p>If you don’t have a local IDE, use AWS Cloud9, a cloud-based IDE for coding, running, and debugging:</p>
<ul>
<li>Create a Cloud9 Environment: Name: cloud9-ecommerce-ide-dev-1 Instance Type: t3.small (2 GiB RAM + 2 vCPU) Platform: Amazon Linux 2 Cost-Saving Setting: Automatically stop after 30 minutes of inactivity</li>
<li>Set Up Permissions: Create an IAM role for Cloud9 with permissions to access Kinesis and S3: Role Name: ecommerce-ec2-simulation-app-iam-role Policies: AmazonS3FullAccess, AmazonKinesisFullAccess Attach this IAM role to your Cloud9 instance.</li>
<li>Simulation Setup: Create a new folder in Cloud9: ecomm-simulation-app-v1. Save the simulation code as stream-data-app-simulation.py in this folder. Install additional packages if needed: pip install boto3 -t .. The simulation app will write to the Kinesis stream and read from an S3 bucket. The default retention period for the data stream is 1 day.</li>
</ul>
</section>
<section id="using-aws-glue-and-athena-for-kinesis-partition-key" class="level3">
<h3 class="anchored" data-anchor-id="using-aws-glue-and-athena-for-kinesis-partition-key">Using AWS Glue and Athena for Kinesis Partition Key</h3>
<ul>
<li>Partition Key Selection: Read data from CSV in S3 and push it to Kinesis in JSON format. Choose a partition key with good cardinality (e.g., category_id), aiming for a balanced load across shards.</li>
<li>AWS Glue: Create a Glue Crawler to define the schema: - Crawler Name: ecommerce-user-activity-crawler-1 - Source Type: Data stores (S3) - Include Path: ecommerce-raw-euwest1-14317-dev/ecomm_user_activity_sample - IAM Role: AWSGlueServiceRole-ecommerce-user-activity - Database Name: db_ecommerce Run the crawler to create a table. This will allow querying in Athena.</li>
</ul>
</section>
<section id="configuring-kinesis-data-analytics-with-apache-flink" class="level3">
<h3 class="anchored" data-anchor-id="configuring-kinesis-data-analytics-with-apache-flink">Configuring Kinesis Data Analytics with Apache Flink</h3>
<pre><code>- Kinesis Data Analytics:
    Allows real-time analytics on streaming data.
    Supports multiple data sources and output sinks.
- Apache Flink:
  A framework for stateful computations on unbounded and bounded data streams.
- Set Up Kinesis Data Analytics:
  - Create a new data stream: ecommerce-raw-user-activity-stream-2.
  - Go to AWS Kinesis -&gt; Analytics Applications -&gt; Studio -&gt; Create Studio Notebook:
    Notebook Name: ecommerce-streaming-app-v1
    Runtime: Apache Flink 1.13
    Source: ecommerce-raw-user-activity-stream-1
    Destination: ecommerce-raw-user-activity-stream-2
    S3 Code Destination: ecommerce-raw-euwest1-14317-dev
  - Apache Flink App:
    Ensure IAM role permissions for Glue are set.</code></pre>
<p>### Lambda Functions for Data Processing - Create Lambda Functions: Set up Lambda to read from the second stream and write to DynamoDB, CloudWatch, and SNS. - Lambda Configuration: Permissions: Attach policies for CloudWatch, DynamoDB, Kinesis, and SNS. Environment Variables: cloudwatch_metric: ecomm-user-high-volume-events cloudwatch_namespace: ecommerce-namespace-1 dynamodb_control_table: ddb-ecommerce-tab-1 topic_arn: [Your SNS Topic ARN] Create SNS Topic: Name: ecommerce-high-severity-incidents Subscription: Email-JSON DynamoDB Table: Table Name: Same as dynamodb_control_table Partition Key: ddb_partition_key (String) Sort Key: ddb_sort_key (Number)</p>
</section>
<section id="integrate-lambda-and-kinesis" class="level3">
<h3 class="anchored" data-anchor-id="integrate-lambda-and-kinesis">Integrate Lambda and Kinesis</h3>
<pre><code>In Lambda, add a trigger for ecommerce-raw-user-activity-stream-2 with a batch size of 1.</code></pre>
</section>
<section id="etl-with-aws-glue-studio-databrew-and-apache-spark" class="level3">
<h3 class="anchored" data-anchor-id="etl-with-aws-glue-studio-databrew-and-apache-spark">ETL with AWS Glue Studio, DataBrew, and Apache Spark</h3>
<pre><code>- Convert CSV to Parquet:
  Use AWS Glue Studio to create a job that reads CSV from S3, transforms it, and writes Parquet files back to S3.
- Use DataBrew:
  Create a data profile to determine optimal partition key variables.</code></pre>
</section>
<section id="persist-raw-stream-data-with-amazon-kinesis-firehose" class="level3">
<h3 class="anchored" data-anchor-id="persist-raw-stream-data-with-amazon-kinesis-firehose">Persist Raw Stream Data with Amazon Kinesis Firehose</h3>
<pre><code>Preserve raw data in S3 to ensure no loss during analytics processes.</code></pre>
</section>
<section id="quicksight-configuration" class="level3">
<h3 class="anchored" data-anchor-id="quicksight-configuration">QuickSight Configuration</h3>
<pre><code>Go to QuickSight -&gt; Enterprise Edition.
Manage permissions to access the relevant S3 bucket.</code></pre>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{voon2024,
  author = {Voon, Sharon},
  title = {End-to-End {Real-Time} {eCommerce} {Analytics} {Pipeline}
    Using {AWS}},
  date = {2024-02-11},
  url = {https://s-voon.github.io/blogs/ecommerce_analytics/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-voon2024" class="csl-entry quarto-appendix-citeas" role="listitem">
Voon, Sharon. 2024. <span>“End-to-End Real-Time eCommerce Analytics
Pipeline Using AWS.”</span> February 11, 2024. <a href="https://s-voon.github.io/blogs/ecommerce_analytics/">https://s-voon.github.io/blogs/ecommerce_analytics/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2024, Sharon Voon</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/s-voon">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/sharonvoon/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>